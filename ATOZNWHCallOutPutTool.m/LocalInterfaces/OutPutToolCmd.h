//===================================================================
// COPYRIGHT atoz 2020/11/20
//===================================================================
// OutPutToolCmd.cpp
// Header definition of class OutPutToolCmd
//===================================================================
//
// Usage notes:
//
//===================================================================
//  2020/11/20 Creation: Code generated by the 3DS wizard
//===================================================================

#ifndef OutPutToolCmd_H
#define OutPutToolCmd_H

#include "CATStateCommand.h"
#include "CATBoolean.h"
#include "CATApplicationFrame.h"
#include "OutPutToolDlg.h"
#include "CATDlgSelectorList.h"
#include "CATPathElementAgent.h"
#include "CATPathElement.h"
#include "CATIAlias.h"
#include "CATISktUse2DWFFactory.h"
#include "iostream.h"
#include "CATDlgNotify.h"
#include "CATDlgUtility.h"
#include "CATFrmEditor.h"
#include "CATIStrUseSketchBasedDMSMngt.h"
#include "CATIPLMNavOccurrence.h"
#include "CATIMmiUsePrtPart.h"
#include "CATIMmiPrtContainer.h"
#include "CATIMmiUseSetFactory.h"
#include "CATIMmiUseCreateImport.h"
#include "CATMmiUseServicesFactory.h"
#include "CATIVisProperties.h"
#include "CATIModelEvents.h"
#include "CATModifyVisProperties.h"
#include "CATIRedrawEvent.h"
#include "CATISktUseSketch.h"
#include "CATISktUse2DWFGeometry.h"
#include "CATIMfPoint.h"
#include "CATIMfZeroDimResult.h"
#include "CATIMfMonoDimResult.h"
#include "CATIGSMUsePointCoord.h"
#include "CATPoint.h"
#include "CATCGMAttribute.h"
#include "CATICGMUnknown.h"
#include "CATISktUse2DProperties.h"
#include <vector>
#include <utility>
#include "CATIUseEntity.h"
#include "DataCommonProtocolServices.h"
#include "CATIDftCoordDimension.h"
#include <math.h>
#include <sstream>
#include<iomanip>
#include<map>
#include "CATIPLMNavRepReference.h"
#include "CATISktUseSketchFactory.h"
#include "CATISktUse2DLine.h"
#include "CATIUdfInstantiate.h"
#include "CATISktUse2DCurve.h"
#include <math.h>

using namespace std;
class CATIndicationAgent;

//----------------------------------------------------------------------

/**
* Describe your command here.
* <p>
* Using this prefered syntax will enable mkdoc to document your class.
* <p>
* refer to programming resources of Dialog engine framework.
* (consult base class description).
*/
class OutPutToolCmd: public CATStateCommand
{
// Allows customization/internationalization of command's messages
// ---------------------------------------------------------------
DeclareResource( OutPutToolCmd, CATStateCommand )

public:

OutPutToolCmd();
virtual ~OutPutToolCmd();
HRESULT InitializeMainDialog();
void PathElementString(CATPathElement * ipPath, CATUnicodeString & oPathName);
HRESULT OptimizeHeights(vector<pair<double, double>>& ivPoints, const double RootPoint[3], const double HAxis[3], const double VAxis[3], vector<pair<double, double>>& onewPoints);
void ExitCmd();

void OKAction();
int DisplayMessage(const CATString &istrMsgType,
	const CATUnicodeString &iusMsgToDisplay,
	const CATUnicodeString &iusDlgTitle);

HRESULT Get2DWFFactory(CATISktUse2DWFFactory* &pCATISktUse2DWFFactory, CATISktUseSketch* &opSketch);
HRESULT CAAGsiCreateGeometricFeatureSets(CATIMmiUsePrtPart_var spPrtPart,
	CATUnicodeString strGSMName,
	CATIMmiMechanicalFeature_var &ospGsmTool);
HRESULT GetCurrentPart(CATIMmiUsePrtPart_var &ospPrtPart);
HRESULT CopyObjectIntoSpecGeoTool(CATIMmiMechanicalFeature_var  spGeometryTool, CATBaseUnknown_var ispSelSketchReferPlaneBU, CATIMmiMechanicalFeature_var &ospResult);
HRESULT CAAUpdateObject(CATBaseUnknown_var spUpdateObjectBU);
HRESULT GetOldCords(const CATLISTV(CATISktUse2DWFGeometry_var) &listofPoints, vector<pair<double, double>>& ivPoints);
void PrintCords(const vector<pair<double, double>>& ivPoints);
HRESULT AdjustXY(const pair<double, double>& fixed, pair<double, double>& fixing, vector<pair<double, double>>& ovPoints);
double round(double src, int bits);
const double getPoint(double n);
inline double getDistance(double xCord2, double yCord2, double xCord1, double yCord1)
{
	return sqrt(((xCord2 - xCord1)*(xCord2 - xCord1)) + ((yCord2 - yCord1)*(yCord2 - yCord1)));
}

inline double round(double src)
{
	return (double)(src * 10.0) / 10.0;
}

const double getZ(const double RootPoint[3], const double HAxis[3], const double VAxis[3], CATISktUse2DWFGeometry_var spGPoint);
const double getZ(const double RootPoint[3], const double HAxis[3], const double VAxis[3],
	const pair<double, double>& ivPoint, const double testY);
const double getZ(const double RootPoint[3], const double HAxis[3], const double VAxis[3], const pair<double, double>& ivPoint);
const double getZ(const double RootPoint[3], const double HAxis[3], const double VAxis[3],
	CATISktUse2DWFGeometry_var spGPoint, const double testY);
HRESULT PrintAll3DCords(const CATLISTV(CATISktUse2DWFGeometry_var) &listofPoints, const double RootPoint[3], const double HAxis[3], const double VAxis[3]);
void PrintAllDistance(const CATLISTV(CATISktUse2DWFGeometry_var) &listofPoints);
HRESULT OptimizePoints(vector<pair<double, double>>& ivPoints, vector<pair<double, double>>& ovPoints);
HRESULT ChangePointData(CATLISTV(CATISktUse2DWFGeometry_var) &listofLine,
	const vector<pair<double, double>>& ivPoints);
HRESULT ShowAll3DCords(const CATLISTV(CATISktUse2DWFGeometry_var) &listofPoints, const double RootPoint[3], const double HAxis[3], const double VAxis[3]);
void Optimization();
void PrintCurrentCords();

/**
* Defines the command automata.
* <br>
* <i>(states, transitions and agents)</i>
*/
virtual void     BuildGraph();

private:
	OutPutToolDlg* _pOutPutToolDlg;
	CATIMmiUsePrtPart_var _spCurrentPart;
	
	vector<pair<double, double>> _vCord; //点原始坐标表
	vector<pair<double, double>> _vNewCord;//优化高程值后的新点坐标表
	vector<pair<double, double>> _finalPoints;

	CATPathElementAgent* _pSelComponentPathElemAgent;
	CATISktUse2DWFFactory* _pCATISktUse2DWFFactory;
	CATISktUseSketch* _pSketch;

};

//----------------------------------------------------------------------

#endif
